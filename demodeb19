# Офис HQ
Имя подсети | Количество адресов | IP адрес подсети  | Маска подсети      | Префикс маски | Диапазон адресов              
----------- | ------------------ | ----------------- | ------------------ | ------------- | -------------------------------
VLAN100     | 64                 | 192.168.100.0     | 255.255.255.192    | /26           | 192.168.100.1 - 192.168.100.62
VLAN200     | 16                 | 192.168.100.64    | 255.255.255.240    | /28           | 192.168.100.65 - 192.168.100.78
VLAN999     | 8                  | 192.168.100.80    | 255.255.255.248    | /29           | 192.168.100.81 - 192.168.100.86

# Офис BR
Имя подсети | Количество адресов | IP адрес подсети  | Маска подсети      | Префикс маски | Диапазон адресов              
----------- | ------------------ | ----------------- | ------------------ | ------------- | -------------------------------
HQ          | 32                 | 192.168.200.0     | 255.255.255.224    | /27           | 192.168.200.1 - 192.168.200.30

# Таблица адресации устройств
Имя устройства | Интерфейс |  IP-адрес         | Шлюз по умолчанию | Сеть                  
-------------- | ----------|------------------ | ----------------- | -----------------------
ISP            | ens3      | DHCP              | -                 | Internet              
               | ens4      | 172.16.4.1/28     | -                 | ISP_HQ-RTR            
               | ens5      | 172.16.5.1/28     | -                 | ISP_BR-RTR            
============================================================================================
HQ-RTR         | ens3      | 172.16.4.2/28     | 172.16.4.1        | ISP_HQ-RTR            
               | ens4      | 192.168.100.1/26  | -                 | HQ-RTR_HQ-SRV (VLAN100)
               | ens5      | 192.168.100.65/28 | -                 | HQ-RTR_HQ-CLI (VLAN200)
               | ens6      | 192.168.100.81/29 | -                 | VLAN999               
============================================================================================
HQ-SRV         | ens3      | 192.168.100.2/26  | 192.168.100.1     | HQ-RTR_HQ-SRV         
============================================================================================
HQ-CLI         | ens3      | DHCP              | 192.168.100.65    | HQ-RTR_HQ-CLI         
============================================================================================
BR-RTR         | ens3      | 172.16.5.2/28     | 172.16.5.1        | ISP_BR-RTR            
               | ens4      | 192.168.200.1/27  | -                 | BR-RTR_BR-SRV         
============================================================================================
BR-SRV         | ens3      | 192.168.200.2/27  | 192.168.200.1     | BR-RTR_BR-SRV         




1. Изменение файла /etc/hostname
sudo nano /etc/hostname

ISP:
isp.au-team.irpo
HQ-RTR:
hq-rtr.au-team.irpo
BR-RTR:
br-rtr.au-team.irpo
HQ-SRV:
hq-srv.au-team.irpo
HQ-CLI:
hq-cli.au-team.irpo
BR-SRV:
br-srv.au-team.irpo

2. Изменение файла /etc/hosts
sudo nano /etc/hosts

ISP:
127.0.1.1       isp.au-team.irpo
HQ-RTR:
127.0.1.1       hq-rtr.au-team.irpo
HQ-SRV:
127.0.1.1       hq-srv.au-team.irpo
HQ-CLI:
127.0.1.1       hq-cli.au-team.irpo
BR-RTR:
127.0.1.1       br-rtr.au-team.irpo
BR-SRV:
127.0.1.1       br-srv.au-team.irpo

Задаем IP адреса сетевым интерфейсам согласно таблицы адресации.
nmtui
Настройка ISP
Internet-ISP ens3 auto
ISP_HQ-RTR ens4 172.16.4.1/28
ISP_BR-RTR ens5 172.16.5.1/28

Настройка HQ-RTR
ISP_HQ-RTR ens3 172.16.4.2/28 Шлюз 172.16.4.1 Серверы DNS 77.88.8.8
Настройка ens4, ens5, ens6 будет произведена при настройке VLAN

Настройка HQ-SRV
HQ-RTR_HQ-SRV ens3 192.168.100.2/26 Шлюз 192.168.100.1

Настройка HQ-CLI
Получает IP – адрес по DHCP

Настройка BR-RTR
ISP-BR-RTR ens3 172.16.5.2/28 Шлюз 172.16.5.1 Серверы DNS 77.88.8.8
BR-RTR-BR-SRV ens4 192.168.200.1/27 

Настройка BR-SRV
BR-RTR_BR-SRV ens3 192.168.200.2/27 Шлюз 192.168.200.1

Проверить результат настройки IP- адресов можно с помощью команд на выбор:
ip a
ip –c a
ip –c –br a

Включить пересылку пакетов между интерфейсами на ISP, HQ-RTR, BR-RTR.
nano /etc/sysctl.conf
net.ipv4.ip_forward=1
sysctl -p

Настройка NAT с помощью iptables на ISP, HQ-RTR, BR-RTR.
iptables -t nat -A POSTROUTING -o ens3 -j MASQUERADE

Сохранение iptables‑правил
apt update
apt install iptables-persistent

Если впоследствии потребуется сохранить изменённые правила:
sudo iptables-save | sudo tee /etc/iptables/rules.v4

Проверка iptables‑правил:
sudo iptables -t nat -L -n -v



Создание локальных учетных записей на серверах HQ-SRV и BR-SRV
sudo useradd sshuser -u 1010 -U
sudo passwd sshuser
P@ssw0rd

Предоставление прав sudo без запроса пароля
sudo usermod -aG sudo sshuser
sudo visudo
sshuser ALL=(ALL) NOPASSWD: ALL

Создание пользователя net_admin на маршрутизаторах HQ‑RTR и BR‑RTR
sudo useradd net_admin -U
sudo passwd net_admin
P@$$word

Предоставление привилегий sudo без запроса пароля
sudo usermod -aG sudo net_admin
sudo visudo
net_admin ALL=(ALL) NOPASSWD: ALL



I. Настройка OpenvSwitch на HQ-RTR

1. Установка необходимых пакетов
Обновите списки пакетов и установите Open vSwitch и DHCP-сервер (isc-dhcp-server):
sudo apt update
sudo apt install -y openvswitch-switch isc-dhcp-server

2. Запуск и автозапуск службы Open vSwitch
sudo systemctl enable --now openvswitch-switch

3. Создание виртуального коммутатора (моста) и настройка VLAN
sudo ovs-vsctl add-br hq-sw

Добавляем физические интерфейсы с VLAN-тегированием:
sudo ovs-vsctl add-port hq-sw ens4 tag=100
sudo ovs-vsctl add-port hq-sw ens5 tag=200
sudo ovs-vsctl add-port hq-sw ens6 tag=999

3.2. Добавление внутренних портов (internal) для управления VLAN
sudo ovs-vsctl add-port hq-sw vlan100 tag=100 -- set interface vlan100 type=internal
sudo ovs-vsctl add-port hq-sw vlan200 tag=200 -- set interface vlan200 type=internal
sudo ovs-vsctl add-port hq-sw vlan999 tag=999 -- set interface vlan999 type=internal

3.3. Включение моста и внутренних интерфейсов
sudo ip link set hq-sw up
sudo ip link set vlan100 up
sudo ip link set vlan200 up
sudo ip link set vlan999 up

3.4. Назначение IP-адресов внутренним портам
sudo ip addr add 192.168.100.1/26 dev vlan100
sudo ip addr add 192.168.100.65/28 dev vlan200
sudo ip addr add 192.168.100.81/29 dev vlan999

4. Автоматизация сохранения настроек Open vSwitch после перезагрузки
4.1. Скрипт восстановления конфигурации
sudo nano /usr/local/sbin/ovs-persistent.sh
Вставьте следующий код:

#!/bin/bash
# Удаляем существующий мост, если он есть, для чистой конфигурации
ovs-vsctl --if-exists del-br hq-sw
ovs-vsctl add-br hq-sw

# Добавляем физические интерфейсы с нужными тегами
ovs-vsctl add-port hq-sw ens4 tag=100
ovs-vsctl add-port hq-sw ens5 tag=200
ovs-vsctl add-port hq-sw ens6 tag=999

# Добавляем внутренние порты с тегами VLAN
ovs-vsctl add-port hq-sw vlan100 tag=100 -- set interface vlan100 type=internal
ovs-vsctl add-port hq-sw vlan200 tag=200 -- set interface vlan200 type=internal
ovs-vsctl add-port hq-sw vlan999 tag=999 -- set interface vlan999 type=internal

# Включаем мост и внутренние интерфейсы
ip link set hq-sw up
ip link set vlan100 up
ip link set vlan200 up
ip link set vlan999 up

# Назначаем IP-адреса внутренним интерфейсам
ip addr add 192.168.100.1/26 dev vlan100 || true
ip addr add 192.168.100.65/28 dev vlan200 || true
ip addr add 192.168.100.81/29 dev vlan999 || true

Сохраните файл и сделайте его исполняемым:
sudo chmod +x /usr/local/sbin/ovs-persistent.sh

4.2. Создание systemd‑сервиса
sudo nano /etc/systemd/system/ovs-persistent.service
Вставьте следующее содержимое:

[Unit]
Description=Restore Open vSwitch configuration on boot
After=openvswitch-switch.service
Requires=openvswitch-switch.service

[Service]
Type=oneshot
ExecStart=/usr/local/sbin/ovs-persistent.sh
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target

Сохраните файл, затем выполните:
sudo systemctl daemon-reload
sudo systemctl enable ovs-persistent.service
sudo systemctl start ovs-persistent.service

Теперь при каждой загрузке системы скрипт автоматически восстановит нужную конфигурацию.

5. Настройка DHCP-сервера для VLAN 200 (для HQ‑CLI)
Клиент HQ‑CLI должен получать IP-адреса по DHCP из подсети VLAN 200.

5.1. Указание интерфейса для DHCP
sudo nano /etc/default/isc-dhcp-server
INTERFACES="vlan200"

5.2. Конфигурация файла dhcpd.conf
sudo nano /etc/dhcp/dhcpd.conf

subnet 192.168.100.64 netmask 255.255.255.240 {
    range 192.168.100.66 192.168.100.78;
    option routers 192.168.100.65;
    option subnet-mask 255.255.255.240;
    option domain-name-servers 8.8.8.8, 8.8.4.4;
    option broadcast-address 192.168.100.79;
    default-lease-time 600;
    max-lease-time 7200;
}

5.3. Перезапуск DHCP-сервера
sudo systemctl restart isc-dhcp-server
sudo systemctl enable isc-dhcp-server





1. Настройка SSH-сервера на HQ-SRV и BR-SRV.
1.1. Редактирование файла конфигурации SSH
sudo nano /etc/ssh/sshd_config
Port 2024

Разрешение подключения только для пользователя sshuser:
AllowUsers sshuser

Ограничение количества попыток авторизации:
MaxAuthTries 2

Настройка баннера:
#Banner none
Banner /etc/ssh-banner
sudo nano /etc/ssh-banner
Впишите строку:

***********************************************************
*                                                         *
*                  Authorized access only!                *
*                                                         *
***********************************************************

1.3. Перезапуск SSH-сервера
sudo systemctl restart sshd


Проверка настроек:
С другого устройства (например, с HQ‑CLI) выполните подключение к серверу по порту 2024:
ssh -p 2024 sshuser@<IP_адрес_сервера>






GRE-туннель между HQ-RTR и BR-RTR
Настройка HQ-RTR

# nmtui
Выбираем «Изменить подключение»
Выбираем «Добавить»
Выбираем «IP-туннель"
Задаём понятные имена «tun1» и «tun1»
«Режим работы» выбираем «GRE»
«Родительский» указываем интерфейс в сторону ISP (ens3)
задаём «Локальный IP» (IP на интерфейсе HQ-RTR в сторону IPS 172.16.4.2)
задаём «Удалённый IP» (IP на интерфейсе BR-RTR в сторону ISP 172.16.5.2)
переходим к «КОНФИГУРАЦИЯ IPv4»
задаём адрес IPv4 для туннеля (10.10.0.1/30)

Для корректной работы протокола динамической маршрутизации требуется увеличить параметр TTL на интерфейсе туннеля:
nmcli connection modify tun1 ip-tunnel.ttl 64
Активируем (перезагружаем) интерфейс tun1
Проверяем:
ip -c --br a

Настройка BR-RTR
Настройка GRE – туннеля на BR-RTR производится аналогично HQ-RTR
nmtui
Производим настройку

Выбираем «Изменить подключение»
Выбираем «Добавить»
Выбираем «IP-туннель
Задаём понятные имена «tun2» и «tun2»
«Режим работы» выбираем «GRE»
«Родительский» указываем интерфейс в сторону ISP (ens3)
задаём «Локальный IP» (IP на интерфейсе BR-RTR в сторону IPS 172.16.5.2)
задаём «Удалённый IP» (IP на интерфейсе HQ-RTR в сторону ISP 172.16.4.2)
переходим к «КОНФИГУРАЦИЯ IPv4»
задаём адрес IPv4 для туннеля (10.10.0.2/30)

Для корректной работы протокола динамической маршрутизации требуется увеличить параметр TTL на интерфейсе туннеля:
nmcli connection modify tun1 ip-tunnel.ttl 64
Активируем (перезагружаем) интерфейс tun1
ip -c a








Для выполнения задания выполните следующие шаги:

1. Настройка GRE-туннеля между HQ-RTR и BR-RTR:

На HQ-RTR:

bash
Copy
ip tunnel add tun0 mode gre remote 172.16.5.2 local 172.16.4.2
ip addr add 192.168.255.1/30 dev tun0
ip link set tun0 up
На BR-RTR:

bash
Copy
ip tunnel add tun0 mode gre remote 172.16.4.2 local 172.16.5.2
ip addr add 192.168.255.2/30 dev tun0
ip link set tun0 up
2. Установка и активация FRR (OSPF):
На обоих роутерах:

bash
Copy
apt update && apt install -y frr
sed -i 's/ospfd=no/ospfd=yes/' /etc/frr/daemons
systemctl restart frr
3. Настройка OSPF с аутентификацией:
На HQ-RTR (vtysh):

bash
Copy
configure terminal
interface tun0
 ip ospf authentication message-digest
 ip ospf message-digest-key 1 md5 SecurePass123
exit
router ospf
 network 192.168.100.0/26 area 0
 network 192.168.100.64/28 area 0
 network 192.168.100.80/29 area 0
 network 192.168.255.0/30 area 0
 area 0 authentication message-digest
exit
write
На BR-RTR (vtysh):

bash
Copy
configure terminal
interface tun0
 ip ospf authentication message-digest
 ip ospf message-digest-key 1 md5 SecurePass123
exit
router ospf
 network 192.168.200.0/27 area 0
 network 192.168.255.0/30 area 0
 area 0 authentication message-digest
exit
write
4. Проверка настройки:

bash
Copy
vtysh -c "show ip ospf neighbor"
vtysh -c "show ip route"
5. Включение IP-форвардинга:
На обоих роутерах:

bash
Copy
echo "net.ipv4.ip_forward=1" >> /etc/sysctl.conf
sysctl -p
Результат:

Маршрутизаторы обмениваются маршрутами через защищенный OSPF-туннель

Сети HQ доступны из BR и наоборот

OSPF активирован только на туннельных интерфейсах

Используется MD5-аутентификация для защиты протокола








Для выполнения задания выполните следующие шаги:


2. Установка и активация FRR (OSPF):
На обоих роутерах:

apt update && apt install -y frr
sed -i 's/ospfd=no/ospfd=yes/' /etc/frr/daemons
systemctl restart frr
3. Настройка OSPF с аутентификацией:
На HQ-RTR (vtysh):

configure terminal
interface tun1
 ip ospf authentication message-digest
 ip ospf message-digest-key 1 md5 Test123
exit
router ospf
 network 192.168.100.0/26 area 0
 network 192.168.100.64/28 area 0
 network 10.10.0.0/30 area 0
 area 0 authentication message-digest
exit
write


На BR-RTR (vtysh):
configure terminal
interface tun1
 ip ospf authentication message-digest
 ip ospf message-digest-key 1 md5 Test123
exit
router ospf
 network 192.168.200.0/27 area 0
 network 10.10.0.0/30 area 0
 area 0 authentication message-digest
exit
write

4. Проверка настройки:

vtysh -c "show ip ospf neighbor"
vtysh -c "show ip route"



Маршрутизаторы обмениваются маршрутами через защищенный OSPF-туннель

Сети HQ доступны из BR и наоборот

OSPF активирован только на туннельных интерфейсах

Используется MD5-аутентификация для защиты протокола









sudo truncate -s 0 /etc/frr/frr.conf


Ниже приведена подробная инструкция для настройки OSPF (с использованием FRR версии 7.5.1) на маршрутизаторах HQ‑RTR и BR‑RTR в Debian 10. В данной конфигурации:

• Используется OSPFv2 для динамической маршрутизации между офисами.  
• Маршрутизаторы обмениваются маршрутами только через интерфейс IP-туннеля (например, GRE‑туннель, именуемый здесь tun1).  
• По умолчанию все интерфейсы переводятся в пассивный режим, а туннельный интерфейс исключается (то есть – становится активным для OSPF).  
• Для защиты обмена маршрутной информацией применяется аутентификация с использованием открытого пароля (message-digest, MD5).  

Ниже – пошаговая инструкция для HQ‑RTR (аналогичные настройки выполняются на BR‑RTR с изменением объявляемых сетей).

---

## 1. Установка FRR и базовая настройка

1.1. **Установка FRR через apt**

На Debian 10 выполните:
```bash
sudo apt update
sudo apt install -y frr
```
При установке убедитесь, что пакет FRR установлен без ошибок.

1.2. **Редактирование файла /etc/frr/daemons**

Откройте файл:
```bash
sudo nano /etc/frr/daemons
```
Найдите и отредактируйте строки так, чтобы для OSPFv2 было:
```
zebra=yes
ospfd=yes
```
Остальные демоны можно оставить выключенными (например, bgpd, ripd, ospf6d, если не используются). Сохраните изменения (Ctrl+O, Enter, Ctrl+X).

1.3. **Запуск FRR и автозапуск**

Включите и запустите службу FRR:
```bash
sudo systemctl enable --now frr
```

---

## 2. Настройка OSPF на HQ‑RTR

### 2.1. Вход в FRR через vtysh

Запустите CLI FRR:
```bash
sudo vtysh
```
Вы должны увидеть приглашение вида:
```
hq-rtr.au-team.irpo#
```
Если имя хоста не соответствует, его можно задать через hostnamectl (описано в предыдущих инструкциях).

### 2.2. Вход в режим глобальной конфигурации

Введите:
```
hq-rtr.au-team.irpo# configure terminal
```

### 2.3. Конфигурация OSPF

Перейдите в конфигурацию OSPF:
```
hq-rtr.au-team.irpo(config)# router ospf
```

**a) Перевод всех интерфейсов в пассивный режим**

Чтобы по умолчанию OSPF не отправлял Hello-пакеты на всех интерфейсах:
```
hq-rtr.au-team.irpo(config-router)# passive-interface default
```

**b) Объявление локальных сетей и сети туннеля**

Предположим, что офис HQ использует следующие подсети:
- VLAN100: 192.168.100.0/26  
- VLAN200: 192.168.100.64/28

Также сеть для туннеля между HQ‑RTR и BR‑RTR – 10.10.0.0/30. Добавьте команды:
```
hq-rtr.au-team.irpo(config-router)# network 192.168.100.0/26 area 0
hq-rtr.au-team.irpo(config-router)# network 192.168.100.64/28 area 0
hq-rtr.au-team.irpo(config-router)# network 10.10.0.0/30 area 0
```

**c) Включение аутентификации для области 0**

Чтобы маршрутизаторы обменивались OSPF-сообщениями только при наличии корректной аутентификации, включите её:
```
hq-rtr.au-team.irpo(config-router)# area 0 authentication
```

### 2.4. Настройка туннельного интерфейса (tun1) для OSPF

Перейдите в режим конфигурации интерфейса туннеля:
```
hq-rtr.au-team.irpo(config)# interface tun1
```

На FRR 7.5.1 аутентификацию на интерфейсе можно задать в режиме интерфейса, а также необходимо исключить этот интерфейс из пассивного режима (поскольку по умолчанию в router ospf мы перевели все интерфейсы в passive). Для этого в FRR версии 7.5.1 используется команда в контексте маршрутизатора.

**Шаг 1. В режиме интерфейса включите аутентификацию:**
```
hq-rtr.au-team.irpo(config-if)# ip ospf authentication message-digest
hq-rtr.au-team.irpo(config-if)# ip ospf message-digest-key 1 md5 mypassword
```
*Замените* `mypassword` *на требуемый пароль.*

**Шаг 2. Выходим из режима интерфейса:**
```
hq-rtr.au-team.irpo(config-if)# exit
```

**Шаг 3. В режиме OSPF отключите пассивный режим для интерфейса tun1**

Вернитесь в режим конфигурации OSPF:
```
hq-rtr.au-team.irpo(config)# router ospf
```
Отключите пассивный режим для tun1:
```
hq-rtr.au-team.irpo(config-router)# no passive-interface tun1
```

**Дополнительная рекомендация по типу сети интерфейса (если требуется)**  
Если туннельный интерфейс по умолчанию определён как широковещательный, что может вызвать проблемы, можно явно задать тип сети (например, point-to-point):
```
hq-rtr.au-team.irpo(config-router)# interface tun1
hq-rtr.au-team.irpo(config-if)# ip ospf network point-to-point
hq-rtr.au-team.irpo(config-if)# exit
```
*Примечание:* В FRR 7.5.1 настройка типа сети может отличаться, поэтому если в вашей среде используется GRE-туннель, тип point-to-point часто является оптимальным.

### 2.5. Сохранение конфигурации

Выйдите из режима конфигурации и сохраните изменения:
```
hq-rtr.au-team.irpo(config-router)# exit
hq-rtr.au-team.irpo(config)# exit
hq-rtr.au-team.irpo# write
```
Если команда `write` не сохраняет конфигурацию, попробуйте:
```
hq-rtr.au-team.irpo# copy running-config startup-config
```

---

## 3. Настройка OSPF на BR‑RTR

Настройка на BR‑RTR выполняется аналогично, с изменением объявляемых сетей. Например, если локальная сеть офиса BR – 192.168.200.0/27, то:

1. Войдите в vtysh:
   ```bash
   sudo vtysh
   ```
2. Перейдите в режим глобальной конфигурации:
   ```
   br-rtr.au-team.irpo# configure terminal
   ```
3. Настройте OSPF:
   ```
   br-rtr.au-team.irpo(config)# router ospf
   br-rtr.au-team.irpo(config-router)# passive-interface default
   br-rtr.au-team.irpo(config-router)# network 192.168.200.0/27 area 0
   br-rtr.au-team.irpo(config-router)# network 10.10.0.0/30 area 0
   br-rtr.au-team.irpo(config-router)# area 0 authentication
   ```
4. Перейдите в режим настройки туннельного интерфейса (например, tun1):
   ```
   br-rtr.au-team.irpo(config)# interface tun1
   br-rtr.au-team.irpo(config-if)# ip ospf authentication message-digest
   br-rtr.au-team.irpo(config-if)# ip ospf message-digest-key 1 md5 mypassword
   br-rtr.au-team.irpo(config-if)# exit
   ```
5. В режиме OSPF отключите пассивный режим для туннельного интерфейса:
   ```
   br-rtr.au-team.irpo(config)# router ospf
   br-rtr.au-team.irpo(config-router)# no passive-interface tun1
   ```
6. Сохраните конфигурацию:
   ```
   br-rtr.au-team.irpo# write
   ```

---

## 4. Проверка работы OSPF

После настройки на обоих маршрутизаторах выполните следующие проверки:

1. **Проверка соседства OSPF**

Введите:
```bash
sudo vtysh -c "show ip ospf neighbor"
```
Убедитесь, что между HQ‑RTR и BR‑RTR установлено соседство по интерфейсу туннеля.

2. **Просмотр маршрутов, полученных через OSPF**

Введите:
```bash
sudo vtysh -c "show ip route ospf"
```
Проверьте, что маршруты из удалённого офиса появились в таблице маршрутизации.

3. **Проверка текущей конфигурации FRR**

В режиме vtysh:
```bash
sudo vtysh -c "show running-config"
```
Убедитесь, что все команды (объявление сетей, отключение пассивного режима для tun1, настройки аутентификации) отображаются корректно.

---

## Итоговая схема

**На HQ‑RTR:**
- FRR установлен (версия 7.5.1), демон ospfd включён в **/etc/frr/daemons**.
- В OSPF переведены в пассивный режим все интерфейсы по умолчанию.
- Объявлены офисные сети 192.168.100.0/26 и 192.168.100.64/28, а также сеть туннеля 10.10.0.0/30 в area 0.
- Аутентификация для area 0 включена командой `area 0 authentication`.
- Туннельный интерфейс tun1 настроен с включённой аутентификацией (MD5, ключ 1, пароль «mypassword»), а в конфигурации OSPF для него отключён пассивный режим с помощью `no passive-interface tun1`.
- При необходимости, тип сети на туннельном интерфейсе задан как point-to-point.

**На BR‑RTR:**
- Настройка аналогична, но объявлена локальная сеть офиса BR (например, 192.168.200.0/27) и тот же туннель 10.10.0.0/30.
- Аутентификация и исключение интерфейса tun1 из пассивного режима выполняются аналогичным образом.

Эта конфигурация обеспечивает обмен маршрутами между HQ‑RTR и BR‑RTR через OSPF с защитой паролем, а OSPF работает только по туннельному интерфейсу, тем самым маршрутизаторы делятся маршрутами только друг с другом.

---

При возникновении вопросов или необходимости дальнейшей отладки, можно использовать команды:
- `show ip ospf neighbor` – для просмотра соседей.
- `show ip route ospf` – для просмотра маршрутов, полученных через OSPF.
- `show running-config` – для проверки текущей конфигурации FRR.

Эта инструкция адаптирована для Debian 10 и FRR версии 7.5.1.



4

