[HQ]
hq-srv ansible_host=192.168.100.2 ansible_port=2024 ansible_user=sshuser
hq-cli ansible_host=192.168.100.X ansible_user=user
hq-rtr ansible_host=172.16.4.2 ansible_user=net_admin

[BR]
br-rtr ansible_host=172.16.5.2 ansible_user=net_admin







Шаг 1. Подготовка на BR‑SRV (источнике ключей)
1.1. Убедитесь, что для пользователя sshuser создан домашний каталог и у него правильные права
Если вы планируете генерировать ключи для пользователя sshuser на BR‑SRV, необходимо убедиться, что его домашний каталог существует и имеет корректные права. Если каталог отсутствует или права неверны, выполните следующие команды от имени root:

bash
Копировать
Редактировать
sudo mkdir -p /home/sshuser/.ssh
sudo chown -R sshuser:sshuser /home/sshuser
sudo chmod 700 /home/sshuser/.ssh
1.2. Переключитесь на пользователя sshuser
Чтобы сгенерировать ключи от имени пользователя sshuser, выполните:

bash
Копировать
Редактировать
su - sshuser
Теперь вы должны оказаться в домашнем каталоге пользователя sshuser (обычно /home/sshuser).

1.3. Генерация пары SSH‑ключей
Запустите команду генерации ключей:

bash
Копировать
Редактировать
ssh-keygen -t rsa
При появлении запроса:

"Enter file in which to save the key" — нажмите Enter, чтобы использовать значение по умолчанию: /home/sshuser/.ssh/id_rsa
При запросе пароля можно оставить его пустым (просто нажмите Enter дважды), если политика безопасности позволяет не задавать пароль.
После этого в каталоге /home/sshuser/.ssh должны появиться файлы:

id_rsa (закрытый ключ)
id_rsa.pub (открытый ключ)
Шаг 2. Копирование SSH‑ключей на целевые машины
Для копирования открытого ключа на целевые машины используйте команду ssh-copy-id. Если на целевых машинах SSH-сервер слушает на нестандартном порту, используйте опцию -p.

2.1. Копирование ключа на HQ‑SRV (SSH порт изменен, например, 2024)
На BR‑SRV (под пользователем, у которого сгенерированы ключи) выполните:

bash
Копировать
Редактировать
ssh-copy-id -p 2024 sshuser@192.168.100.2
При этом вам будет предложено ввести пароль для пользователя sshuser на HQ‑SRV.

2.2. Копирование ключа на HQ‑CLI
Если на HQ‑CLI используется пользователь user (или иной, укажите корректное имя):

bash
Копировать
Редактировать
ssh-copy-id user@192.168.100.66
2.3. Копирование ключа на HQ‑RTR
Если на HQ‑RTR используется пользователь net_admin:

bash
Копировать
Редактировать
ssh-copy-id net_admin@172.16.4.2
2.4. Копирование ключа на BR‑RTR
Если на BR‑RTR используется пользователь net_admin:

bash
Копировать
Редактировать
ssh-copy-id net_admin@172.16.5.2
После выполнения каждой из команд открытый ключ будет добавлен в файл ~/.ssh/authorized_keys на целевой машине, что позволит подключаться без ввода пароля.

Шаг 3. Проверка подключения
После успешного копирования ключей проверьте возможность подключения с BR‑SRV к каждой машине без запроса пароля. Например:

bash
Копировать
Редактировать
ssh -p 2024 sshuser@192.168.100.2
ssh user@192.168.100.66
ssh net_admin@172.16.4.2
ssh net_admin@172.16.5.2
