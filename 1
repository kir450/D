Вариант 1. Сгенерировать новую пару ключей для пользователя sshuser
Переключитесь на пользователя sshuser (если вы уже не в его сессии):

bash
Копировать
Редактировать
su - sshuser
Проверьте наличие каталога .ssh:

bash
Копировать
Редактировать
ls -la ~/.ssh
Если каталога нет, создайте его:

bash
Копировать
Редактировать
mkdir -p ~/.ssh
chmod 700 ~/.ssh
Сгенерируйте пару SSH‑ключей:

bash
Копировать
Редактировать
ssh-keygen -t rsa
Следуйте инструкциям (можете оставить пароль пустым, если это допустимо).

После генерации попробуйте снова выполнить команду:

bash
Копировать
Редактировать
ssh-copy-id -p 2024 sshuser@192.168.100.2
Вариант 2. Скопировать существующие ключи из /root/.ssh в домашний каталог sshuser
Если вы хотите использовать уже сгенерированные ключи (находящиеся в /root/.ssh), скопируйте их в домашний каталог пользователя sshuser:

Выполните от имени root:
bash
Копировать
Редактировать
sudo mkdir -p /home/sshuser/.ssh
sudo cp /root/.ssh/id_rsa /home/sshuser/.ssh/
sudo cp /root/.ssh/id_rsa.pub /home/sshuser/.ssh/
sudo chown -R sshuser:sshuser /home/sshuser/.ssh
sudo chmod 600 /home/sshuser/.ssh/id_rsa
sudo chmod 644 /home/sshuser/.ssh/id_rsa.pub
Переключитесь на пользователя sshuser и выполните:
bash
Копировать
Редактировать
ssh-copy-id -p 2024 sshuser@192.168.100.2





















1. Редактирование конфигурационного файла chrony
На Debian 10 основной конфигурационный файл chrony находится по пути /etc/chrony/chrony.conf.

Откройте его для редактирования:

bash
Копировать
Редактировать
sudo nano /etc/chrony/chrony.conf
Внесите следующие изменения (пример для HQ‑RTR как NTP‑сервера):

conf
Копировать
Редактировать
# /etc/chrony/chrony.conf - Конфигурация NTP-сервера на HQ-RTR

# Использование локальных часов как резервного источника времени с заданным stratum
local stratum 5

# Файл для хранения данных о дрейфе часов
driftfile /var/lib/chrony/chrony.drift

# Включаем синхронизацию аппаратных часов с системным временем
rtcsync

# Разрешаем клиентам из внутренних сетей синхронизироваться с этим сервером
allow 192.168.100.0/26
allow 192.168.100.64/28
allow 192.168.200.0/27

# Каталог для логов chrony
logdir /var/log/chrony

# Если необходимо сделать резкое изменение времени при большой разнице (например, при запуске):
makestep 1.0 3

# (Опционально) Закомментируйте внешние источники времени, если хотите работать только с локальным источником.
# pool 2.debian.pool.ntp.org iburst
Сохраните изменения (Ctrl+O, Enter) и выйдите из редактора (Ctrl+X).

2. Применение изменений
Перезапустите службу chrony, чтобы новые настройки вступили в силу:

bash
Копировать
Редактировать
sudo systemctl restart chrony
sudo systemctl enable chrony
Проверьте статус службы:

bash
Копировать
Редактировать
sudo systemctl status chrony
3. Проверка работы NTP-сервера
На HQ‑RTR выполните:

Проверка источников времени:

bash
Копировать
Редактировать
chronyc sources
В выводе вы должны увидеть, что сервер использует локальный источник (локальные часы) с заданным stratum 5.

Проверка подключённых клиентов:
Если на HQ‑RTR есть NTP-клиенты, можно выполнить:

bash
Копировать
Редактировать
chronyc clients
Это покажет, какие устройства синхронизируются с вашим сервером.

4. Настройка клиентов
На машинах-клиентах (HQ‑SRV, HQ‑CLI, BR‑RTR, BR‑SRV):

Установите chrony (если ещё не установлен):

bash
Копировать
Редактировать
sudo apt update
sudo apt install -y chrony
Отредактируйте файл /etc/chrony/chrony.conf на клиентах:

Закомментируйте или удалите существующие строки с pool ….

Добавьте строку, указывающую на HQ‑RTR как NTP‑сервер. Например, если IP HQ‑RTR равен 172.16.4.2 (или другой, в зависимости от вашей таблицы адресации), добавьте:

conf
Копировать
Редактировать
server 172.16.4.2 iburst
Примените изменения:

bash
Копировать
Редактировать
sudo systemctl restart chrony
sudo systemctl enable chrony
Проверьте, что клиент синхронизируется с вашим NTP‑сервером:

bash
Копировать
Редактировать
chronyc sources
Итог
На HQ‑RTR настроен chrony как NTP‑сервер с локальным stratum 5, с разрешением подключения для внутренних подсетей (192.168.100.0/26, 192.168.100.64/28, 192.168.200.0/27).
На клиентах chrony настроен на получение времени от HQ‑RTR (с помощью строки server 172.16.4.2 iburst или другого IP, соответствующего вашему серверу).
Изменения применяются через перезапуск службы, а команда chronyc sources позволяет убедиться в корректной синхронизации.
Таким образом, после выполнения этих шагов, ваша система синхронизации времени будет работать корректно.
